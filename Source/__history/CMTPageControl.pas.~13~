unit CMTPageControl;

interface

uses
  System.SysUtils, System.Classes, Vcl.Controls, Vcl.ComCtrls, Winapi.Windows,
  Vcl.Graphics;

type
  TCMTPageControl = class(TPageControl)
  private
    FBackground: TPicture;
    FBackgroundColor: TColor;
    FBackgroundStyle: TBackgroundStyle;
    procedure SetBackground(const Value: TPicture);
    procedure SetBackgroundColor(const Value: TColor);
    procedure SetBackgroundStyle(const Value: TBackgroundStyle);
  protected
    procedure PaintWindow(DC: HDC); override;
  public
    constructor Create(AOwner: TComponent); override;
    destructor Destroy; override;
  published
    property Background: TPicture read FBackground write SetBackground;
    property BackgroundColor: TColor read FBackgroundColor write SetBackgroundColor default clBtnFace;
    property BackgroundStyle: TBackgroundStyle read FBackgroundStyle write SetBackgroundStyle default bsStretch;
  end;

procedure Register;

implementation

procedure Register;
begin
  RegisterComponents('CMT', [TCMTPageControl]);
end;


constructor TCometPageControl.Create(AOwner: TComponent);
begin
  inherited;
  FBackground := TPicture.Create;
  FBackgroundColor := clBtnFace;   // cor padrão
  FBackgroundStyle := bsStretch;   // estilo padrão
end;

destructor TCometPageControl.Destroy;
begin
  FBackground.Free;
  inherited;
end;

procedure TCometPageControl.PaintWindow(DC: HDC);
var
  R: TRect;
  X, Y: Integer;
begin
  inherited; // pinta o controle normalmente

  Canvas.Handle := DC;
  R := ClientRect;

  // pinta o fundo com a cor escolhida
  Canvas.Brush.Color := FBackgroundColor;
  Canvas.FillRect(R);

  // se tiver imagem, desenha conforme estilo
  if Assigned(FBackground.Graphic) then
  begin
    case FBackgroundStyle of
      bsStretch:
        Canvas.StretchDraw(R, FBackground.Graphic);

      bsCenter:
        begin
          X := (Width - FBackground.Graphic.Width) div 2;
          Y := (Height - FBackground.Graphic.Height) div 2;
          Canvas.Draw(X, Y, FBackground.Graphic);
        end;

      bsTile:
        begin
          for X := 0 to Width div FBackground.Graphic.Width do
            for Y := 0 to Height div FBackground.Graphic.Height do
              Canvas.Draw(X * FBackground.Graphic.Width, Y * FBackground.Graphic.Height, FBackground.Graphic);
        end;
    end;
  end;
end;

procedure TCometPageControl.SetBackground(const Value: TPicture);
begin
  FBackground.Assign(Value);
  Invalidate;
end;

procedure TCometPageControl.SetBackgroundColor(const Value: TColor);
begin
  if FBackgroundColor <> Value then
  begin
    FBackgroundColor := Value;
    Invalidate;
  end;
end;

procedure TCometPageControl.SetBackgroundStyle(const Value: TBackgroundStyle);
begin
  if FBackgroundStyle <> Value then
  begin
    FBackgroundStyle := Value;
    Invalidate;
  end;
end;

end.
